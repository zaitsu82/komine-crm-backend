openapi: 3.0.3
info:
  title: Cemetery CRM API
  description: å¢“çŸ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆCemetery Management Systemï¼‰ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API
  version: 1.0.0
  contact:
    name: Cemetery CRM Support

servers:
  - url: http://localhost:4000
    description: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
  - url: http://localhost:4000/api/v1
    description: API v1 ãƒ™ãƒ¼ã‚¹URL

tags:
  - name: Auth
    description: èªè¨¼é–¢é€£ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - name: Plots
    description: åŒºç”»ï¼ˆå¢“çŸ³ï¼‰ç®¡ç†
  - name: Masters
    description: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
  - name: Staff
    description: ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†
  - name: Documents
    description: æ›¸é¡ç®¡ç†ï¼ˆPDFç”Ÿæˆãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰

paths:
  /api/v1/auth/login:
    post:
      tags:
        - Auth
      summary: ãƒ­ã‚°ã‚¤ãƒ³
      description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã€JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        "200":
          description: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        $ref: "#/components/schemas/StaffPublic"
                      session:
                        type: object
                        properties:
                          access_token:
                            type: string
                          refresh_token:
                            type: string
                          expires_at:
                            type: integer
                            description: ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ï¼ˆUNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
                            example: 1704067200
        "401":
          $ref: "#/components/responses/Unauthorized"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /api/v1/plots:
    get:
      tags:
        - Plots
      summary: å¥‘ç´„åŒºç”»ä¸€è¦§å–å¾—
      description: å¥‘ç´„åŒºç”»ã®ä¸€è¦§ã‚’å–å¾—ï¼ˆæ¤œç´¢ãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰ã€‚ç‰©ç†åŒºç”»ã¨å¥‘ç´„æƒ…å ±ã‚’å«ã‚€ã€‚
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆ1ã‹ã‚‰é–‹å§‹ï¼‰
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: search
          in: query
          description: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåŒºç”»ç•ªå·ã€é¡§å®¢åã§æ¤œç´¢ï¼‰
          schema:
            type: string
        - name: usageStatus
          in: query
          description: ä½¿ç”¨çŠ¶æ³ãƒ•ã‚£ãƒ«ã‚¿
          schema:
            type: string
        - name: cemeteryType
          in: query
          description: å¢“åœ°ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿
          schema:
            type: string
      responses:
        "200":
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ContractPlotSummary"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    post:
      tags:
        - Plots
      summary: æ–°è¦å¥‘ç´„åŒºç”»ä½œæˆ
      description: ç‰©ç†åŒºç”»ã¨å¥‘ç´„åŒºç”»ã‚’åŒæ™‚ã«ä½œæˆã€‚é¡§å®¢æƒ…å ±ã€è²©å£²å¥‘ç´„ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ã‚‚å«ã‚€ã€‚
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePlotInput"
      responses:
        "201":
          description: ä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                        description: ä½œæˆã•ã‚ŒãŸContractPlotã®ID
                      message:
                        type: string
                        example: å¥‘ç´„åŒºç”»ã‚’ä½œæˆã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/plots/{id}:
    get:
      tags:
        - Plots
      summary: å¥‘ç´„åŒºç”»è©³ç´°å–å¾—
      description: æŒ‡å®šã—ãŸå¥‘ç´„åŒºç”»ã®è©³ç´°æƒ…å ±ã‚’å–å¾—ã€‚ç‰©ç†åŒºç”»ã€é¡§å®¢ã€è²©å£²å¥‘ç´„ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å«ã‚€ã€‚
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: å¥‘ç´„åŒºç”»IDï¼ˆUUIDï¼‰
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/ContractPlotDetail"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      tags:
        - Plots
      summary: å¥‘ç´„åŒºç”»æ›´æ–°
      description: å¥‘ç´„åŒºç”»æƒ…å ±ã‚’æ›´æ–°ã€‚éƒ¨åˆ†æ›´æ–°ã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆcontractPlot, saleContract, customer, workInfo, billingInfo, usageFee, managementFeeï¼‰ã€‚
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: å¥‘ç´„åŒºç”»IDï¼ˆUUIDï¼‰
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePlotInput"
      responses:
        "200":
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      message:
                        type: string
                        example: å¥‘ç´„åŒºç”»ã‚’æ›´æ–°ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      tags:
        - Plots
      summary: å¥‘ç´„åŒºç”»å‰Šé™¤ï¼ˆè«–ç†å‰Šé™¤ï¼‰
      description: å¥‘ç´„åŒºç”»ã‚’è«–ç†å‰Šé™¤ã€‚é–¢é€£ã™ã‚‹è²©å£²å¥‘ç´„ã€ä½¿ç”¨æ–™ã€ç®¡ç†æ–™ã€è«‹æ±‚æƒ…å ±ã€å‹¤å‹™å…ˆæƒ…å ±ã‚‚å‰Šé™¤ã€‚é¡§å®¢ã¯ä»–ã®å¥‘ç´„ãŒãªã„å ´åˆã®ã¿å‰Šé™¤ã€‚ç‰©ç†åŒºç”»ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯è‡ªå‹•æ›´æ–°ã€‚
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: å¥‘ç´„åŒºç”»IDï¼ˆUUIDï¼‰
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: å‰Šé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: å¥‘ç´„åŒºç”»ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
                      id:
                        type: string
                        format: uuid
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plots/{id}/contracts:
    get:
      tags:
        - Plots
      summary: ç‰©ç†åŒºç”»ã®å¥‘ç´„ä¸€è¦§å–å¾—
      description: æŒ‡å®šã—ãŸç‰©ç†åŒºç”»ã«ç´ã¥ãå…¨ã¦ã®å¥‘ç´„ã‚’å–å¾—ã€‚åˆ†å‰²è²©å£²ã®å ´åˆã€è¤‡æ•°ã®å¥‘ç´„ãŒè¿”ã•ã‚Œã‚‹ã€‚
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ç‰©ç†åŒºç”»IDï¼ˆUUIDï¼‰
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/PhysicalPlotContracts"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    post:
      tags:
        - Plots
      summary: ç‰©ç†åŒºç”»ã«æ–°è¦å¥‘ç´„è¿½åŠ 
      description: æ—¢å­˜ã®ç‰©ç†åŒºç”»ã«æ–°ã—ã„å¥‘ç´„ã‚’è¿½åŠ ï¼ˆåˆ†å‰²è²©å£²ï¼‰ã€‚å¥‘ç´„é¢ç©ã®æ¤œè¨¼ã‚’å®Ÿæ–½ã—ã€ç‰©ç†åŒºç”»ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è‡ªå‹•æ›´æ–°ã€‚
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ç‰©ç†åŒºç”»IDï¼ˆUUIDï¼‰
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePlotContractInput"
      responses:
        "201":
          description: ä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                        description: ä½œæˆã•ã‚ŒãŸContractPlotã®ID
                      message:
                        type: string
                        example: å¥‘ç´„ã‚’ä½œæˆã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/plots/{id}/inventory:
    get:
      tags:
        - Plots
      summary: ç‰©ç†åŒºç”»ã®åœ¨åº«çŠ¶æ³å–å¾—
      description: ç‰©ç†åŒºç”»ã®åœ¨åº«çŠ¶æ³ã‚’å–å¾—ã€‚ç·é¢ç©ã€å‰²å½“æ¸ˆé¢ç©ã€åˆ©ç”¨å¯èƒ½é¢ç©ã€åˆ©ç”¨ç‡ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¿”ã™ã€‚
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ç‰©ç†åŒºç”»IDï¼ˆUUIDï¼‰
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/PhysicalPlotInventory"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/staff:
    get:
      tags:
        - Staff
      summary: ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§å–å¾—
      description: ã‚¹ã‚¿ãƒƒãƒ•ã®ä¸€è¦§ã‚’å–å¾—ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰ã€‚å‰Šé™¤æ¸ˆã¿ã‚¹ã‚¿ãƒƒãƒ•ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆ1ã‹ã‚‰é–‹å§‹ï¼‰
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: role
          in: query
          description: å½¹å‰²ã§ãƒ•ã‚£ãƒ«ã‚¿
          schema:
            type: string
            enum: [viewer, operator, manager, admin]
        - name: is_active
          in: query
          description: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã§ãƒ•ã‚£ãƒ«ã‚¿
          schema:
            type: boolean
      responses:
        "200":
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      staff:
                        type: array
                        items:
                          $ref: "#/components/schemas/StaffAdmin"
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 20
                          total:
                            type: integer
                            example: 50
                          totalPages:
                            type: integer
                            example: 3
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    post:
      tags:
        - Staff
      summary: ã‚¹ã‚¿ãƒƒãƒ•æ–°è¦ç™»éŒ²
      description: |
        æ–°ã—ã„ã‚¹ã‚¿ãƒƒãƒ•ã‚’ç™»éŒ²ã—ã¾ã™ã€‚
        - Supabase Admin APIã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
        - å–å¾—ã—ãŸsupabase_uidã§Staffãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
        - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œ
        - ç®¡ç†è€…æ¨©é™ï¼ˆadminï¼‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateStaffRequest"
      responses:
        "201":
          description: ä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/StaffAdmin"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"

  /api/v1/staff/{id}:
    get:
      tags:
        - Staff
      summary: ã‚¹ã‚¿ãƒƒãƒ•è©³ç´°å–å¾—
      description: æŒ‡å®šã•ã‚ŒãŸIDã®ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ã‚’å–å¾—
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ã‚¹ã‚¿ãƒƒãƒ•ID
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/StaffAdmin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      tags:
        - Staff
      summary: ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±æ›´æ–°
      description: |
        ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™ã€‚
        - åå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€å½¹å‰²ã®æ›´æ–°
        - Supabaseå´ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ›´æ–°ã‚‚åŒæœŸ
        - ç®¡ç†è€…æ¨©é™ï¼ˆadminï¼‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ã‚¹ã‚¿ãƒƒãƒ•ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateStaffRequest"
      responses:
        "200":
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/StaffAdmin"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

    delete:
      tags:
        - Staff
      summary: ã‚¹ã‚¿ãƒƒãƒ•å‰Šé™¤ï¼ˆã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆï¼‰
      description: |
        ã‚¹ã‚¿ãƒƒãƒ•ã‚’è«–ç†å‰Šé™¤ã—ã¾ã™ã€‚
        - deleted_atã«ç¾åœ¨æ—¥æ™‚ã‚’è¨­å®š
        - is_activeã‚’falseã«æ›´æ–°
        - ç‰©ç†å‰Šé™¤ã¯è¡Œã‚ãªã„
        - ç®¡ç†è€…æ¨©é™ï¼ˆadminï¼‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ã‚¹ã‚¿ãƒƒãƒ•ID
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: å‰Šé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: ã‚¹ã‚¿ãƒƒãƒ•ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  # ==================== Documents API ====================

  /api/v1/documents:
    get:
      tags:
        - Documents
      summary: æ›¸é¡ä¸€è¦§å–å¾—
      description: æ›¸é¡ã®ä¸€è¦§ã‚’å–å¾—ï¼ˆæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆ1ã‹ã‚‰é–‹å§‹ï¼‰
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: contractPlotId
          in: query
          description: å¥‘ç´„åŒºç”»IDã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          schema:
            type: string
            format: uuid
        - name: customerId
          in: query
          description: é¡§å®¢IDã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          schema:
            type: string
            format: uuid
        - name: type
          in: query
          description: æ›¸é¡ã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          schema:
            $ref: "#/components/schemas/DocumentType"
        - name: status
          in: query
          description: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          schema:
            $ref: "#/components/schemas/DocumentStatus"
        - name: sortBy
          in: query
          description: ã‚½ãƒ¼ãƒˆé …ç›®
          schema:
            type: string
            enum: [created_at, updated_at, name, type, status]
            default: created_at
        - name: sortOrder
          in: query
          description: ã‚½ãƒ¼ãƒˆé †
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: "#/components/schemas/DocumentListItem"
                      pagination:
                        $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      tags:
        - Documents
      summary: æ›¸é¡ä½œæˆ
      description: æ–°è¦æ›¸é¡ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDocumentRequest"
      responses:
        "201":
          description: ä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/DocumentDetail"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/documents/generate-pdf:
    post:
      tags:
        - Documents
      summary: PDFç”Ÿæˆ
      description: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰PDFã‚’ç”Ÿæˆï¼ˆBase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§è¿”å´ï¼‰
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GeneratePdfRequest"
      responses:
        "200":
          description: PDFç”ŸæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/GeneratePdfResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/documents/{id}:
    get:
      tags:
        - Documents
      summary: æ›¸é¡è©³ç´°å–å¾—
      description: æŒ‡å®šã•ã‚ŒãŸIDã®æ›¸é¡è©³ç´°ã‚’å–å¾—
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: æ›¸é¡ID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/DocumentDetail"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      tags:
        - Documents
      summary: æ›¸é¡æ›´æ–°
      description: æ›¸é¡ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: æ›¸é¡ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateDocumentRequest"
      responses:
        "200":
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/DocumentDetail"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      tags:
        - Documents
      summary: æ›¸é¡å‰Šé™¤ï¼ˆè«–ç†å‰Šé™¤ï¼‰
      description: æ›¸é¡ã‚’è«–ç†å‰Šé™¤ï¼ˆdeleted_atã«æ—¥æ™‚ã‚’è¨­å®šï¼‰
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: æ›¸é¡ID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: å‰Šé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: æ›¸é¡ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/documents/{id}/upload:
    post:
      tags:
        - Documents
      summary: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      description: æ›¸é¡ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆæœ€å¤§10MBï¼‰
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: æ›¸é¡ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆPDF, Word, Excel, ç”»åƒï¼‰
      responses:
        "200":
          description: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      fileName:
                        type: string
                        example: invoice_2024.pdf
                      fileSize:
                        type: integer
                        example: 102400
                      mimeType:
                        type: string
                        example: application/pdf
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/documents/{id}/download:
    get:
      tags:
        - Documents
      summary: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLå–å¾—
      description: ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLï¼ˆPre-signed URLï¼‰ã‚’å–å¾—
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: æ›¸é¡ID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: URLå–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      url:
                        type: string
                        format: uri
                        description: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLï¼ˆæœ‰åŠ¹æœŸé™15åˆ†ï¼‰
                      fileName:
                        type: string
                        example: invoice_2024.pdf
                      mimeType:
                        type: string
                        example: application/pdf
                      expiresIn:
                        type: integer
                        description: æœ‰åŠ¹æœŸé™ï¼ˆç§’ï¼‰
                        example: 900
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/documents/file/{fileKey}:
    get:
      tags:
        - Documents
      summary: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      description: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºç’°å¢ƒç”¨ï¼‰
      security:
        - bearerAuth: []
      parameters:
        - name: fileKey
          in: path
          required: true
          description: ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼
          schema:
            type: string
      responses:
        "200":
          description: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Supabaseã‹ã‚‰ç™ºè¡Œã•ã‚ŒãŸJWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨

  schemas:
    # ==================== Document ã‚¹ã‚­ãƒ¼ãƒ ====================

    DocumentType:
      type: string
      description: æ›¸é¡ã‚¿ã‚¤ãƒ—
      enum:
        - invoice
        - postcard
        - contract
        - permit
        - other
      example: invoice

    DocumentStatus:
      type: string
      description: æ›¸é¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
      enum:
        - draft
        - generated
        - sent
        - archived
      example: draft

    DocumentListItem:
      type: object
      description: æ›¸é¡ä¸€è¦§ã‚¢ã‚¤ãƒ†ãƒ 
      properties:
        id:
          type: string
          format: uuid
          description: æ›¸é¡ID
        contractPlotId:
          type: string
          format: uuid
          nullable: true
          description: å¥‘ç´„åŒºç”»ID
        customerId:
          type: string
          format: uuid
          nullable: true
          description: é¡§å®¢ID
        type:
          $ref: "#/components/schemas/DocumentType"
        name:
          type: string
          description: æ›¸é¡å
          example: è«‹æ±‚æ›¸_2024å¹´1æœˆåˆ†
        description:
          type: string
          nullable: true
          description: èª¬æ˜
        status:
          $ref: "#/components/schemas/DocumentStatus"
        fileName:
          type: string
          nullable: true
          description: ãƒ•ã‚¡ã‚¤ãƒ«å
          example: invoice_2024_01.pdf
        fileSize:
          type: integer
          nullable: true
          description: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
          example: 102400
        mimeType:
          type: string
          nullable: true
          description: MIMEã‚¿ã‚¤ãƒ—
          example: application/pdf
        templateType:
          type: string
          nullable: true
          description: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¿ã‚¤ãƒ—
        generatedAt:
          type: string
          format: date-time
          nullable: true
          description: ç”Ÿæˆæ—¥æ™‚
        sentAt:
          type: string
          format: date-time
          nullable: true
          description: é€ä»˜æ—¥æ™‚
        createdBy:
          type: string
          nullable: true
          description: ä½œæˆè€…
        notes:
          type: string
          nullable: true
          description: å‚™è€ƒ
        createdAt:
          type: string
          format: date-time
          description: ä½œæˆæ—¥æ™‚
        updatedAt:
          type: string
          format: date-time
          description: æ›´æ–°æ—¥æ™‚
        contractPlot:
          type: object
          nullable: true
          description: é–¢é€£åŒºç”»æƒ…å ±
          properties:
            id:
              type: string
              format: uuid
            plotNumber:
              type: string
            areaName:
              type: string
        customer:
          type: object
          nullable: true
          description: é–¢é€£é¡§å®¢æƒ…å ±
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            nameKana:
              type: string

    DocumentDetail:
      type: object
      description: æ›¸é¡è©³ç´°
      allOf:
        - $ref: "#/components/schemas/DocumentListItem"
        - type: object
          properties:
            fileKey:
              type: string
              nullable: true
              description: ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ¼ï¼ˆS3/ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
            templateData:
              type: object
              nullable: true
              description: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰
            contractPlot:
              type: object
              nullable: true
              description: é–¢é€£åŒºç”»è©³ç´°
              properties:
                id:
                  type: string
                  format: uuid
                contractAreaSqm:
                  type: number
                contractDate:
                  type: string
                  format: date
                  nullable: true
                physicalPlot:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    plotNumber:
                      type: string
                    areaName:
                      type: string
            customer:
              type: object
              nullable: true
              description: é–¢é€£é¡§å®¢è©³ç´°
              properties:
                id:
                  type: string
                  format: uuid
                name:
                  type: string
                nameKana:
                  type: string
                postalCode:
                  type: string
                address:
                  type: string
                phoneNumber:
                  type: string
                  nullable: true
                email:
                  type: string
                  nullable: true

    CreateDocumentRequest:
      type: object
      description: æ›¸é¡ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      required:
        - type
        - name
      properties:
        contractPlotId:
          type: string
          format: uuid
          description: å¥‘ç´„åŒºç”»ID
        customerId:
          type: string
          format: uuid
          description: é¡§å®¢ID
        type:
          $ref: "#/components/schemas/DocumentType"
        name:
          type: string
          description: æ›¸é¡å
          maxLength: 200
          example: è«‹æ±‚æ›¸_2024å¹´1æœˆåˆ†
        description:
          type: string
          description: èª¬æ˜
        templateType:
          type: string
          description: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆinvoice, postcardï¼‰
        templateData:
          type: object
          description: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
        notes:
          type: string
          description: å‚™è€ƒ

    UpdateDocumentRequest:
      type: object
      description: æ›¸é¡æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      properties:
        name:
          type: string
          description: æ›¸é¡å
          maxLength: 200
        description:
          type: string
          description: èª¬æ˜
        status:
          $ref: "#/components/schemas/DocumentStatus"
        templateData:
          type: object
          description: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
        notes:
          type: string
          description: å‚™è€ƒ

    GeneratePdfRequest:
      type: object
      description: PDFç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      required:
        - templateType
        - templateData
      properties:
        templateType:
          type: string
          enum: [invoice, postcard]
          description: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¿ã‚¤ãƒ—
        templateData:
          type: object
          description: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆè«‹æ±‚æ›¸ã¾ãŸã¯ã¯ãŒãç”¨ï¼‰
        documentId:
          type: string
          format: uuid
          description: é–¢é€£ã™ã‚‹æ›¸é¡IDï¼ˆæŒ‡å®šæ™‚ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ï¼‰
        name:
          type: string
          description: æ›¸é¡å
        contractPlotId:
          type: string
          format: uuid
          description: å¥‘ç´„åŒºç”»ID
        customerId:
          type: string
          format: uuid
          description: é¡§å®¢ID

    GeneratePdfResponse:
      type: object
      description: PDFç”Ÿæˆãƒ¬ã‚¹ãƒãƒ³ã‚¹
      properties:
        documentId:
          type: string
          format: uuid
          description: æ›¸é¡ID
        pdf:
          type: string
          description: Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸPDF
        mimeType:
          type: string
          example: application/pdf
        fileSize:
          type: integer
          description: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
          example: 102400

    # ==================== Staff ã‚¹ã‚­ãƒ¼ãƒ ====================

    Staff:
      type: object
      description: ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ï¼ˆå†…éƒ¨å‡¦ç†ãƒ»DBæ“ä½œç”¨ã€APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ã¯ä½¿ç”¨ã—ãªã„ï¼‰
      properties:
        id:
          type: integer
          description: ã‚¹ã‚¿ãƒƒãƒ•ID
          example: 1
        supabase_uid:
          type: string
          description: Supabase User IDï¼ˆå†…éƒ¨ç®¡ç†ç”¨ï¼‰
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          description: ã‚¹ã‚¿ãƒƒãƒ•å
          example: å±±ç”°å¤ªéƒ
          maxLength: 100
        email:
          type: string
          format: email
          description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
          example: yamada@example.com
          maxLength: 254
        role:
          type: string
          description: å½¹å‰²
          enum: [viewer, operator, manager, admin]
          example: operator
        is_active:
          type: boolean
          description: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
          example: true
        last_login_at:
          type: string
          format: date-time
          description: æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚
          nullable: true
          example: "2024-01-01T12:00:00Z"
        created_at:
          type: string
          format: date-time
          description: ä½œæˆæ—¥æ™‚
          example: "2024-01-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: æ›´æ–°æ—¥æ™‚
          example: "2024-01-01T12:00:00Z"

    StaffPublic:
      type: object
      description: ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ï¼ˆä¸€èˆ¬å…¬é–‹ç”¨ãƒ»èªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ï¼‰
      properties:
        id:
          type: integer
          description: ã‚¹ã‚¿ãƒƒãƒ•ID
          example: 1
        name:
          type: string
          description: ã‚¹ã‚¿ãƒƒãƒ•å
          example: å±±ç”°å¤ªéƒ
        email:
          type: string
          format: email
          description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
          example: yamada@example.com
        role:
          type: string
          description: å½¹å‰²
          enum: [viewer, operator, manager, admin]
          example: operator
        is_active:
          type: boolean
          description: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
          example: true

    StaffAdmin:
      type: object
      description: ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ï¼ˆç®¡ç†è€…ç”¨ãƒ»ç®¡ç†APIç”¨ã€supabase_uidã‚’å«ã¾ãªã„ï¼‰
      properties:
        id:
          type: integer
          description: ã‚¹ã‚¿ãƒƒãƒ•ID
          example: 1
        name:
          type: string
          description: ã‚¹ã‚¿ãƒƒãƒ•å
          example: å±±ç”°å¤ªéƒ
        email:
          type: string
          format: email
          description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
          example: yamada@example.com
        role:
          type: string
          description: å½¹å‰²
          enum: [viewer, operator, manager, admin]
          example: operator
        is_active:
          type: boolean
          description: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
          example: true
        last_login_at:
          type: string
          format: date-time
          description: æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚
          nullable: true
          example: "2024-01-01T12:00:00Z"
        created_at:
          type: string
          format: date-time
          description: ä½œæˆæ—¥æ™‚
          example: "2024-01-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: æ›´æ–°æ—¥æ™‚
          example: "2024-01-01T12:00:00Z"

    CreateStaffRequest:
      type: object
      description: ã‚¹ã‚¿ãƒƒãƒ•æ–°è¦ç™»éŒ²ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      required:
        - name
        - email
        - password
        - role
      properties:
        name:
          type: string
          description: ã‚¹ã‚¿ãƒƒãƒ•å
          example: å±±ç”°å¤ªéƒ
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
          example: yamada@example.com
          maxLength: 254
        password:
          type: string
          format: password
          description: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰
          example: SecurePass123!
          minLength: 8
        role:
          type: string
          description: å½¹å‰²
          enum: [viewer, operator, manager, admin]
          example: operator
        is_active:
          type: boolean
          description: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
          default: true
          example: true

    UpdateStaffRequest:
      type: object
      description: ã‚¹ã‚¿ãƒƒãƒ•æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
      properties:
        name:
          type: string
          description: ã‚¹ã‚¿ãƒƒãƒ•å
          example: å±±ç”°å¤ªéƒ
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
          example: yamada@example.com
          maxLength: 254
        role:
          type: string
          description: å½¹å‰²
          enum: [viewer, operator, manager, admin]
          example: manager
        is_active:
          type: boolean
          description: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
          example: true

    # ==================== ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚­ãƒ¼ãƒ ====================

    ContractPlotSummary:
      type: object
      description: å¥‘ç´„åŒºç”»ã®ã‚µãƒãƒªãƒ¼æƒ…å ±ï¼ˆä¸€è¦§è¡¨ç¤ºç”¨ï¼‰
      properties:
        id:
          type: string
          format: uuid
          description: å¥‘ç´„åŒºç”»ID
          example: 123e4567-e89b-12d3-a456-426614174000
        plotNumber:
          type: string
          description: åŒºç”»ç•ªå·
          example: A-01
        areaName:
          type: string
          description: åŒºåŸŸå
          example: ä¸€èˆ¬å¢“åœ°A
        contractAreaSqm:
          type: number
          format: float
          description: å¥‘ç´„é¢ç©ï¼ˆã¡ï¼‰
          example: 3.6
        customerName:
          type: string
          description: é¡§å®¢å
          example: å±±ç”°å¤ªéƒ
        saleStatus:
          type: string
          description: ç‰©ç†åŒºç”»ã®å¥‘ç´„çŠ¶æ³ï¼ˆå¥‘ç´„é¢ç©ã«åŸºã¥ã„ã¦è¨ˆç®—ï¼‰
          enum: [fully_contracted, partially_contracted, available]
          example: fully_contracted
        contractDate:
          type: string
          format: date
          description: å¥‘ç´„æ—¥
          example: "2024-01-01"
        phoneNumber:
          type: string
          description: é›»è©±ç•ªå·
          example: "09012345678"
        applicantName:
          type: string
          description: ç”³è¾¼è€…å
          example: "å±±ç”°èŠ±å­"
        currentBuriedPersons:
          type: number
          description: ç¾åœ¨åŸ‹è‘¬äººæ•°
          example: 2
        nextBillingDate:
          type: string
          format: date
          description: æ¬¡å›è«‹æ±‚æ—¥ï¼ˆä½¿ç”¨æ–™ãƒ»ç®¡ç†æ–™ã‹ã‚‰è¨ˆç®—ï¼‰
          example: "2024-01-01"
        notes:
          type: string
          description: å‚™è€ƒ
          example: "ğŸš¨ã”é«˜é½¢ã®ãŸã‚ã€é‡è¦ãªèª¬æ˜ã¯å®¶æ—åŒå¸­ã®ä¸Šã§è¡Œã†ã“ã¨ã€‚"

    ContractPlotDetail:
      type: object
      description: å¥‘ç´„åŒºç”»ã®è©³ç´°æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
          description: å¥‘ç´„åŒºç”»ID
        plot_number:
          type: string
          description: å¢“çŸ³ã‚³ãƒ¼ãƒ‰ï¼ˆåŒºç”»ç•ªå·ï¼‰
          example: A-01
        area_name:
          type: string
          description: åŒºåŸŸï¼ˆæœŸï¼‰
          example: 1æœŸ
        area_name_detail:
          type: string
          description: åŒºåŸŸï¼ˆè©³ç´°ï¼‰
          example: å‰ç›¸
        contractAreaSqm:
          type: number
          format: float
          description: å¥‘ç´„é¢ç©ï¼ˆã¡ï¼‰
        saleStatus:
          type: string
          description: è²©å£²ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
          nullable: true
        ApplicantInfo:
          $ref: "#/components/schemas/ApplicantInfo"
        SaleContract:
          $ref: "#/components/schemas/SaleContractInfo"
        UsageFee:
          $ref: "#/components/schemas/UsageFeeInfo"
          nullable: true
        ManagementFee:
          $ref: "#/components/schemas/ManagementFeeInfo"
          nullable: true

    ApplicantInfo:
      type: object
      description: ç”³è¾¼è€…æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        applicantDate:
          type: string
          format: date
          example: "2024-01-01"
        price:
          type: number
          example: 1000000
        paymentStatus:
          type: string
          nullable: true
        reservationDate:
          type: string
          format: date
          nullable: true
        acceptanceNumber:
          type: string
          nullable: true
        permitDate:
          type: string
          format: date
          nullable: true
        startDate:
          type: string
          format: date
          nullable: true
        notes:
          type: string
          nullable: true
        Customer:
          $ref: "#/components/schemas/CustomerInfo"

    SaleContractInfo:
      type: object
      description: è²©å£²å¥‘ç´„æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        contractDate:
          type: string
          format: date
          description: å¥‘ç´„æ—¥
          example: "2024-01-01"
        price:
          type: integer
          description: ä¾¡æ ¼ï¼ˆå††å˜ä½ï¼‰
          example: 1000000
        paymentStatus:
          type: string
          description: æ”¯æ‰•ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
          nullable: true
        reservationDate:
          type: string
          format: date
          description: äºˆç´„æ—¥
          nullable: true
          example: "2024-01-01"
        acceptanceNumber:
          type: string
          description: æ‰¿è«¾æ›¸ç•ªå·
          nullable: true
          example: "AC-2024-0001"
        permitDate:
          type: string
          format: date
          description: è¨±å¯æ—¥
          nullable: true
          example: "2024-01-15"
        permitNumber:
          type: string
          description: è¨±å¯ç•ªå·
          maxLength: 50
          nullable: true
          example: "KYO-2024-0001"
        startDate:
          type: string
          format: date
          description: é–‹å§‹å¹´æœˆæ—¥
          nullable: true
          example: "2024-02-01"
        notes:
          type: string
          description: å‚™è€ƒ
          nullable: true
        Customer:
          $ref: "#/components/schemas/CustomerInfo"

    CustomerInfo:
      type: object
      description: é¡§å®¢æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: å±±ç”°å¤ªéƒ
        nameKana:
          type: string
          example: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦
        birthDate:
          type: string
          format: date
          nullable: true
        gender:
          type: string
          enum: [male, female, other]
          nullable: true
        postalCode:
          type: string
          example: "150-0001"
        address:
          type: string
          example: æ±äº¬éƒ½æ¸‹è°·åŒº
        registeredAddress:
          type: string
          nullable: true
        phoneNumber:
          type: string
          example: "03-1234-5678"
          nullable: true
        faxNumber:
          type: string
          nullable: true
        email:
          type: string
          format: email
          nullable: true
        notes:
          type: string
          nullable: true
        WorkInfo:
          $ref: "#/components/schemas/WorkInfoInfo"
          nullable: true
        BillingInfo:
          $ref: "#/components/schemas/BillingInfoInfo"
          nullable: true

    WorkInfoInfo:
      type: object
      description: å‹¤å‹™å…ˆæƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        companyName:
          type: string
        companyNameKana:
          type: string
        workPostalCode:
          type: string
          nullable: true
        workAddress:
          type: string
          nullable: true
        workPhoneNumber:
          type: string
          nullable: true
        dmSetting:
          type: string
        addressType:
          type: string
        notes:
          type: string
          nullable: true

    BillingInfoInfo:
      type: object
      description: è«‹æ±‚æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        billingType:
          type: string
          nullable: true
        accountType:
          type: string
          nullable: true
        bankName:
          type: string
          nullable: true
        branchName:
          type: string
          nullable: true
        accountNumber:
          type: string
          nullable: true
        accountHolder:
          type: string
          nullable: true

    UsageFeeInfo:
      type: object
      description: ä½¿ç”¨æ–™æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        calculationType:
          type: string
          nullable: true
        taxType:
          type: string
          nullable: true
        billingType:
          type: string
          nullable: true
        billingYears:
          type: string
          nullable: true
        area:
          type: string
          nullable: true
        unitPrice:
          type: string
          nullable: true
        usageFee:
          type: string
          nullable: true
        paymentMethod:
          type: string
          nullable: true

    ManagementFeeInfo:
      type: object
      description: ç®¡ç†æ–™æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        calculationType:
          type: string
          nullable: true
        taxType:
          type: string
          nullable: true
        billingType:
          type: string
          nullable: true
        billingYears:
          type: string
          nullable: true
        area:
          type: string
          nullable: true
        billingMonth:
          type: string
          nullable: true
        managementFee:
          type: string
          nullable: true
        unitPrice:
          type: string
          nullable: true
        lastBillingMonth:
          type: string
          nullable: true
        paymentMethod:
          type: string
          nullable: true

    BuriedPersonInfo:
      type: object
      description: åŸ‹è‘¬è€…æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
        nameKana:
          type: string
          nullable: true
        relationship:
          type: string
          nullable: true
        deathDate:
          type: string
          format: date
          nullable: true
        age:
          type: integer
          nullable: true
        gender:
          type: string
          enum: [male, female, other]
          nullable: true
        burialDate:
          type: string
          format: date
          nullable: true
        graveNumber:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true

    CollectiveBurialInfo:
      type: object
      description: åˆç¥€æƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        burialType:
          type: string
        requestDate:
          type: string
          format: date
          nullable: true
        executionDate:
          type: string
          format: date
          nullable: true
        status:
          type: string
        notes:
          type: string
          nullable: true

    FamilyContactInfo:
      type: object
      description: å®¶æ—é€£çµ¡å…ˆæƒ…å ±
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
        birthDate:
          type: string
          format: date
          nullable: true
        relationship:
          type: string
          nullable: true
        address:
          type: string
          nullable: true
        phoneNumber:
          type: string
          nullable: true
        email:
          type: string
          format: email
          nullable: true

    PhysicalPlotContracts:
      type: object
      description: ç‰©ç†åŒºç”»ã®å¥‘ç´„ä¸€è¦§æƒ…å ±
      properties:
        physicalPlot:
          type: object
          properties:
            id:
              type: string
              format: uuid
            plotNumber:
              type: string
              example: A-01
            areaName:
              type: string
              example: ä¸€èˆ¬å¢“åœ°A
            areaSqm:
              type: number
              format: float
              example: 3.6
            status:
              type: string
              enum: [available, partial, sold_out]
        contracts:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              contractAreaSqm:
                type: number
                format: float
              saleStatus:
                type: string
                nullable: true
              customerName:
                type: string
              contractDate:
                type: string
                format: date
              price:
                type: number
        summary:
          type: object
          properties:
            totalContracts:
              type: integer
              description: å¥‘ç´„ç·æ•°
              example: 2
            totalAllocatedArea:
              type: number
              format: float
              description: å‰²å½“æ¸ˆç·é¢ç©ï¼ˆã¡ï¼‰
              example: 3.6

    PhysicalPlotInventory:
      type: object
      description: ç‰©ç†åŒºç”»ã®åœ¨åº«æƒ…å ±
      properties:
        physicalPlot:
          type: object
          properties:
            id:
              type: string
              format: uuid
            plotNumber:
              type: string
              example: A-01
            areaName:
              type: string
              example: ä¸€èˆ¬å¢“åœ°A
            areaSqm:
              type: number
              format: float
              example: 3.6
        inventory:
          type: object
          properties:
            totalArea:
              type: number
              format: float
              description: ç·é¢ç©ï¼ˆã¡ï¼‰
              example: 3.6
            allocatedArea:
              type: number
              format: float
              description: å‰²å½“æ¸ˆé¢ç©ï¼ˆã¡ï¼‰
              example: 1.8
            availableArea:
              type: number
              format: float
              description: åˆ©ç”¨å¯èƒ½é¢ç©ï¼ˆã¡ï¼‰
              example: 1.8
            utilizationRate:
              type: number
              format: float
              description: åˆ©ç”¨ç‡ï¼ˆ%ï¼‰
              example: 50.0
            status:
              type: string
              enum: [available, partial, sold_out]
              description: åœ¨åº«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
              example: partial
        contracts:
          type: array
          description: æ—¢å­˜å¥‘ç´„ä¸€è¦§
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              contractAreaSqm:
                type: number
                format: float
              saleStatus:
                type: string
                nullable: true
              customerName:
                type: string

    # ==================== ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚­ãƒ¼ãƒ ====================

    CreatePlotInput:
      type: object
      description: æ–°è¦å¥‘ç´„åŒºç”»ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      required:
        - physicalPlot
        - contractPlot
        - saleContract
        - applicant
        - contractor
      properties:
        physicalPlot:
          type: object
          required:
            - plotNumber
            - areaName
            - areaSqm
          properties:
            plotNumber:
              type: string
              description: åŒºç”»ç•ªå·ï¼ˆå¤§æ–‡å­—è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ï¼‰
              pattern: "^[A-Z0-9-]+$"
              maxLength: 50
              example: A-01
            areaName:
              type: string
              description: åŒºç”»ï¼ˆæœŸï¼‰
              maxLength: 100
              example: 2æœŸ
            areaNameDetail:
              type: string
              description: åŒºç”»ï¼ˆè©³ç´°ï¼‰
              maxLength: 100
              example: "8"
            areaSqm:
              type: number
              format: float
              description: é¢ç©ï¼ˆã¡ï¼‰
              minimum: 0.01
              example: 3.6
            notes:
              type: string
              maxLength: 1000
              nullable: true
        contractPlot:
          type: object
          required:
            - contractAreaSqm
          properties:
            contractAreaSqm:
              type: number
              format: float
              description: å¥‘ç´„é¢ç©ï¼ˆã¡ï¼‰
              minimum: 0.01
              example: 3.6
            saleStatus:
              type: string
              maxLength: 50
              nullable: true
              example: completed
            locationDescription:
              type: string
              maxLength: 200
              nullable: true
              example: å—å´
        saleContract:
          type: object
          required:
            - contractDate
            - price
          properties:
            contractDate:
              type: string
              format: date
              description: å¥‘ç´„æ—¥
              example: "2024-01-01"
            price:
              type: number
              description: ä¾¡æ ¼
              minimum: 0
              example: 1000000
            paymentStatus:
              type: string
              maxLength: 50
              nullable: true
            reservationDate:
              type: string
              format: date
              nullable: true
            acceptanceNumber:
              type: string
              maxLength: 50
              nullable: true
            permitDate:
              type: string
              format: date
              description: è¨±å¯æ—¥
              nullable: true
            permitNumber:
              type: string
              maxLength: 50
              description: è¨±å¯ç•ªå·
              nullable: true
              example: "KYO-2024-0001"
            startDate:
              type: string
              format: date
              nullable: true
            notes:
              type: string
              maxLength: 1000
              nullable: true
        applicant:
          type: object
          description: ç”³è¾¼è€…æƒ…å ±
          required:
            - name
            - nameKana
            - postalCode
            - address
          properties:
            applicationDate:
              type: string
              format: date
              description: ç”³è¾¼æ—¥
              nullable: true
              example: "2024-01-01"
            staffName:
              type: string
              description: æ‹…å½“è€…æ°å
              maxLength: 100
              nullable: true
              example: ç”°ä¸­ä¸€éƒ
            name:
              type: string
              description: ç”³è¾¼è€…æ°å
              minLength: 1
              maxLength: 100
              example: å±±ç”°èŠ±å­
            nameKana:
              type: string
              description: ç”³è¾¼è€…æ°åã‚«ãƒŠï¼ˆã‚«ã‚¿ã‚«ãƒŠã®ã¿ï¼‰
              pattern: '^[ã‚¡-ãƒ¶ãƒ¼\s]+$'
              maxLength: 100
              example: ãƒ¤ãƒãƒ€ãƒãƒŠã‚³
            postalCode:
              type: string
              description: éƒµä¾¿ç•ªå·
              minLength: 1
              maxLength: 10
              example: "150-0001"
            phoneNumber:
              type: string
              description: é›»è©±ç•ªå·
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
              example: "03-1234-5678"
            address:
              type: string
              description: ä½æ‰€
              minLength: 1
              maxLength: 200
              example: æ±äº¬éƒ½æ¸‹è°·åŒº
        contractor:
          type: object
          description: å¥‘ç´„è€…æƒ…å ±
          required:
            - name
            - nameKana
            - postalCode
            - address
          properties:
            name:
              type: string
              description: å¥‘ç´„è€…æ°å
              minLength: 1
              maxLength: 100
              example: å±±ç”°å¤ªéƒ
            nameKana:
              type: string
              description: å¥‘ç´„è€…æ°åã‚«ãƒŠï¼ˆã‚«ã‚¿ã‚«ãƒŠã®ã¿ï¼‰
              pattern: '^[ã‚¡-ãƒ¶ãƒ¼\s]+$'
              maxLength: 100
              example: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦
            birthDate:
              type: string
              format: date
              description: ç”Ÿå¹´æœˆæ—¥
              nullable: true
              example: "1980-01-01"
            gender:
              type: string
              description: æ€§åˆ¥
              enum: [male, female, other]
              nullable: true
            postalCode:
              type: string
              description: éƒµä¾¿ç•ªå·
              minLength: 1
              maxLength: 10
              example: "150-0001"
            address:
              type: string
              description: ä½æ‰€
              minLength: 1
              maxLength: 200
              example: æ±äº¬éƒ½æ¸‹è°·åŒº
            registeredAddress:
              type: string
              description: æœ¬ç±åœ°ä½æ‰€
              maxLength: 200
              nullable: true
              example: æ±äº¬éƒ½æ–°å®¿åŒº
            phoneNumber:
              type: string
              description: é›»è©±ç•ªå·
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
              example: "03-1234-5678"
            faxNumber:
              type: string
              description: ãƒ•ã‚¡ãƒƒã‚¯ã‚¹
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
              example: "03-1234-5679"
            email:
              type: string
              description: ãƒ¡ãƒ¼ãƒ«
              format: email
              nullable: true
              example: yamada@example.com
            notes:
              type: string
              maxLength: 1000
              nullable: true
        workInfo:
          type: object
          description: å‹¤å‹™å…ˆæƒ…å ±
          nullable: true
          properties:
            companyName:
              type: string
              description: å‹¤å‹™å…ˆåç§°
              maxLength: 100
              nullable: true
              example: æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«
            companyNameKana:
              type: string
              description: å‹¤å‹™å…ˆä»®åï¼ˆã‚«ã‚¿ã‚«ãƒŠã®ã¿ï¼‰
              pattern: '^[ã‚¡-ãƒ¶ãƒ¼\s]+$'
              maxLength: 100
              nullable: true
              example: ã‚«ãƒ–ã‚·ã‚­ã‚¬ã‚¤ã‚·ãƒ£ã‚µãƒ³ãƒ—ãƒ«
            workPostalCode:
              type: string
              description: éƒµä¾¿ç•ªå·
              maxLength: 10
              nullable: true
              example: "150-0001"
            workPhoneNumber:
              type: string
              description: é›»è©±ç•ªå·
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
              example: "03-1234-5678"
            workAddress:
              type: string
              description: å‹¤å‹™å…ˆä½æ‰€
              maxLength: 200
              nullable: true
              example: æ±äº¬éƒ½æ¸‹è°·åŒº
            workFaxNumber:
              type: string
              description: ãƒ•ã‚¡ãƒƒã‚¯ã‚¹
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
              example: "03-1234-5679"
            dmSetting:
              type: string
              description: DMé€ä¿¡è¨­å®š
              enum: [allow, deny, limited]
              nullable: true
              example: allow
            addressType:
              type: string
              description: å®›å…ˆåŒºåˆ†ï¼ˆé€£çµ¡å…ˆã‚¿ã‚¤ãƒ—ï¼‰
              enum: [home, work, other]
              nullable: true
              example: home
            notes:
              type: string
              description: å‚™è€ƒ
              maxLength: 1000
              nullable: true
        billingInfo:
          type: object
          nullable: true
          properties:
            billingType:
              type: string
              maxLength: 50
              nullable: true
            accountType:
              type: string
              maxLength: 50
              nullable: true
            bankName:
              type: string
              maxLength: 100
              nullable: true
            branchName:
              type: string
              maxLength: 100
              nullable: true
            accountNumber:
              type: string
              maxLength: 20
              nullable: true
            accountHolder:
              type: string
              maxLength: 100
              nullable: true
        usageFee:
          type: object
          nullable: true
          properties:
            calculationType:
              type: string
              maxLength: 50
              nullable: true
            taxType:
              type: string
              maxLength: 50
              nullable: true
            billingType:
              type: string
              maxLength: 50
              nullable: true
            billingYears:
              type: string
              maxLength: 50
              nullable: true
            area:
              type: string
              maxLength: 50
              nullable: true
            unitPrice:
              type: string
              maxLength: 50
              nullable: true
            usageFee:
              type: string
              maxLength: 50
              nullable: true
            paymentMethod:
              type: string
              maxLength: 50
              nullable: true
        managementFee:
          type: object
          nullable: true
          properties:
            calculationType:
              type: string
              maxLength: 50
              nullable: true
            taxType:
              type: string
              maxLength: 50
              nullable: true
            billingType:
              type: string
              maxLength: 50
              nullable: true
            billingYears:
              type: string
              maxLength: 50
              nullable: true
            area:
              type: string
              maxLength: 50
              nullable: true
            billingMonth:
              type: string
              maxLength: 50
              nullable: true
            managementFee:
              type: string
              maxLength: 50
              nullable: true
            unitPrice:
              type: string
              maxLength: 50
              nullable: true
            lastBillingMonth:
              type: string
              pattern: '^\d{4}å¹´\d{1,2}æœˆ$'
              nullable: true
              example: "2024å¹´3æœˆ"
            paymentMethod:
              type: string
              maxLength: 50
              nullable: true
        gravestone:
          type: object
          description: å¢“çŸ³æƒ…å ±
          nullable: true
          properties:
            gravestoneBase:
              type: string
              description: å¢“çŸ³å°ï¼ˆå¢“çŸ³åŸºç¤ï¼‰
              maxLength: 100
              nullable: true
              example: ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆåŸºç¤
            enclosurePosition:
              type: string
              description: åŒ…å›²ä½ç½®ï¼ˆå›²éšœä½ç½®ï¼‰
              maxLength: 100
              nullable: true
              example: å‰é¢é–‹æ”¾
            gravestoneDealer:
              type: string
              description: å¢“çŸ³å–æ‰±ã„ï¼ˆçŸ³æåº—ï¼‰
              maxLength: 100
              nullable: true
              example: çŸ³æåº—A
            gravestoneType:
              type: string
              description: å¢“çŸ³ã‚¿ã‚¤ãƒ—ï¼ˆå¢“çŸ³ç¨®åˆ¥ï¼‰
              maxLength: 50
              nullable: true
              example: å’Œå‹
            surroundingArea:
              type: string
              description: å‘¨è¾ºè¨­å‚™ï¼ˆå‘¨è¾ºåŒºç”»ï¼‰
              maxLength: 100
              nullable: true
              example: æ°´å ´ã‚ã‚Š
            establishmentDeadline:
              type: string
              format: date
              description: è¨­ç«‹æœŸé™ï¼ˆè¨­ç½®æœŸé™ï¼‰
              nullable: true
              example: "2024-12-31"
            establishmentDate:
              type: string
              format: date
              description: è¨­ç«‹æ—¥ï¼ˆè¨­ç½®æ—¥ï¼‰
              nullable: true
              example: "2024-06-01"
        familyContacts:
          type: array
          description: å®¶æ—ãƒ»é€£çµ¡å…ˆæƒ…å ±ï¼ˆé…åˆ—ï¼‰
          nullable: true
          items:
            type: object
            properties:
              emergencyContactFlag:
                type: boolean
                description: ç·Šæ€¥é€£çµ¡å…ˆãƒ•ãƒ©ã‚°
                default: false
                example: true
              name:
                type: string
                description: æ°å
                maxLength: 100
                example: å±±ç”°æ¬¡éƒ
              birthDate:
                type: string
                format: date
                description: ç”Ÿå¹´æœˆæ—¥
                nullable: true
                example: "1985-05-15"
              relationship:
                type: string
                description: ç¶šæŸ„
                maxLength: 50
                example: é•·ç”·
              postalCode:
                type: string
                description: éƒµä¾¿ç•ªå·
                maxLength: 10
                nullable: true
                example: "150-0001"
              address:
                type: string
                description: ä½æ‰€
                maxLength: 200
                example: æ±äº¬éƒ½æ¸‹è°·åŒº
              phoneNumber:
                type: string
                description: é›»è©±ç•ªå·
                pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
                example: "03-1234-5678"
              faxNumber:
                type: string
                description: ãƒ•ã‚¡ãƒƒã‚¯ã‚¹
                pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
                nullable: true
                example: "03-1234-5679"
              email:
                type: string
                format: email
                description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                nullable: true
                example: jiro@example.com
              registeredAddress:
                type: string
                description: æœ¬ç±åœ°ä½æ‰€
                maxLength: 200
                nullable: true
                example: æ±äº¬éƒ½æ–°å®¿åŒº
              mailingType:
                type: string
                description: éƒµé€å…ˆã‚¿ã‚¤ãƒ—
                enum: [home, work, other]
                nullable: true
                example: home
              notes:
                type: string
                description: å‚™è€ƒ
                maxLength: 1000
                nullable: true
        buriedPersons:
          type: array
          description: åŸ‹è‘¬è€…ä¸€è¦§ï¼ˆé…åˆ—ï¼‰
          nullable: true
          items:
            type: object
            properties:
              name:
                type: string
                description: æ°å
                maxLength: 100
                example: å±±ç”°ä¸‰éƒ
              nameKana:
                type: string
                description: æ°åã‚«ãƒŠï¼ˆã‚«ã‚¿ã‚«ãƒŠã®ã¿ï¼‰
                pattern: '^[ã‚¡-ãƒ¶ãƒ¼\s]+$'
                maxLength: 100
                nullable: true
                example: ãƒ¤ãƒãƒ€ã‚µãƒ–ãƒ­ã‚¦
              relationship:
                type: string
                description: ç¶šæŸ„
                maxLength: 50
                nullable: true
                example: ç¥–çˆ¶
              deathDate:
                type: string
                format: date
                description: æ­»äº¡æ—¥
                nullable: true
                example: "2020-03-15"
              age:
                type: integer
                description: å¹´é½¢
                nullable: true
                example: 85
              gender:
                type: string
                description: æ€§åˆ¥
                enum: [male, female, other]
                nullable: true
                example: male
              burialDate:
                type: string
                format: date
                description: åŸ‹è‘¬æ—¥
                nullable: true
                example: "2020-03-20"
              notes:
                type: string
                description: å‚™è€ƒ
                maxLength: 1000
                nullable: true

    UpdatePlotInput:
      type: object
      description: å¥‘ç´„åŒºç”»æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆå…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
      properties:
        contractPlot:
          type: object
          properties:
            contractAreaSqm:
              type: number
              format: float
              minimum: 0.01
            saleStatus:
              type: string
              maxLength: 50
              nullable: true
            locationDescription:
              type: string
              maxLength: 200
              nullable: true
        saleContract:
          type: object
          properties:
            contractDate:
              type: string
              format: date
            price:
              type: number
              minimum: 0
            paymentStatus:
              type: string
              maxLength: 50
              nullable: true
            reservationDate:
              type: string
              format: date
              nullable: true
            acceptanceNumber:
              type: string
              maxLength: 50
              nullable: true
            permitDate:
              type: string
              format: date
              description: è¨±å¯æ—¥
              nullable: true
            permitNumber:
              type: string
              maxLength: 50
              description: è¨±å¯ç•ªå·
              nullable: true
              example: "KYO-2024-0001"
            startDate:
              type: string
              format: date
              nullable: true
            notes:
              type: string
              maxLength: 1000
              nullable: true
        customer:
          type: object
          properties:
            name:
              type: string
              maxLength: 100
            nameKana:
              type: string
              pattern: '^[ã‚¡-ãƒ¶ãƒ¼\s]+$'
              maxLength: 100
            birthDate:
              type: string
              format: date
              nullable: true
            gender:
              type: string
              enum: [male, female, other]
              nullable: true
            postalCode:
              type: string
              maxLength: 10
            address:
              type: string
              maxLength: 200
            registeredAddress:
              type: string
              maxLength: 200
              nullable: true
            phoneNumber:
              type: string
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
            faxNumber:
              type: string
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
            email:
              type: string
              format: email
              nullable: true
            notes:
              type: string
              maxLength: 1000
              nullable: true
        workInfo:
          type: object
          description: å‹¤å‹™å…ˆæƒ…å ±
          nullable: true
          properties:
            companyName:
              type: string
              description: å‹¤å‹™å…ˆåç§°
              maxLength: 100
              nullable: true
              example: æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«
            companyNameKana:
              type: string
              description: å‹¤å‹™å…ˆä»®åï¼ˆã‚«ã‚¿ã‚«ãƒŠã®ã¿ï¼‰
              pattern: '^[ã‚¡-ãƒ¶ãƒ¼\s]+$'
              maxLength: 100
              nullable: true
              example: ã‚«ãƒ–ã‚·ã‚­ã‚¬ã‚¤ã‚·ãƒ£ã‚µãƒ³ãƒ—ãƒ«
            workPostalCode:
              type: string
              description: éƒµä¾¿ç•ªå·
              maxLength: 10
              nullable: true
              example: "150-0001"
            workPhoneNumber:
              type: string
              description: é›»è©±ç•ªå·
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
              example: "03-1234-5678"
            workAddress:
              type: string
              description: å‹¤å‹™å…ˆä½æ‰€
              maxLength: 200
              nullable: true
              example: æ±äº¬éƒ½æ¸‹è°·åŒº
            workFaxNumber:
              type: string
              description: ãƒ•ã‚¡ãƒƒã‚¯ã‚¹
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
              example: "03-1234-5679"
            dmSetting:
              type: string
              description: DMé€ä¿¡è¨­å®š
              enum: [allow, deny, limited]
              nullable: true
              example: allow
            addressType:
              type: string
              description: å®›å…ˆåŒºåˆ†ï¼ˆé€£çµ¡å…ˆã‚¿ã‚¤ãƒ—ï¼‰
              enum: [home, work, other]
              nullable: true
              example: home
            notes:
              type: string
              description: å‚™è€ƒ
              maxLength: 1000
              nullable: true
        billingInfo:
          type: object
          nullable: true
          properties:
            billingType:
              type: string
              maxLength: 50
              nullable: true
            accountType:
              type: string
              maxLength: 50
              nullable: true
            bankName:
              type: string
              maxLength: 100
              nullable: true
            branchName:
              type: string
              maxLength: 100
              nullable: true
            accountNumber:
              type: string
              maxLength: 20
              nullable: true
            accountHolder:
              type: string
              maxLength: 100
              nullable: true
        usageFee:
          type: object
          nullable: true
          properties:
            calculationType:
              type: string
              maxLength: 50
              nullable: true
            taxType:
              type: string
              maxLength: 50
              nullable: true
            billingType:
              type: string
              maxLength: 50
              nullable: true
            billingYears:
              type: string
              maxLength: 50
              nullable: true
            area:
              type: string
              maxLength: 50
              nullable: true
            unitPrice:
              type: string
              maxLength: 50
              nullable: true
            usageFee:
              type: string
              maxLength: 50
              nullable: true
            paymentMethod:
              type: string
              maxLength: 50
              nullable: true
        managementFee:
          type: object
          nullable: true
          properties:
            calculationType:
              type: string
              maxLength: 50
              nullable: true
            taxType:
              type: string
              maxLength: 50
              nullable: true
            billingType:
              type: string
              maxLength: 50
              nullable: true
            billingYears:
              type: string
              maxLength: 50
              nullable: true
            area:
              type: string
              maxLength: 50
              nullable: true
            billingMonth:
              type: string
              maxLength: 50
              nullable: true
            managementFee:
              type: string
              maxLength: 50
              nullable: true
            unitPrice:
              type: string
              maxLength: 50
              nullable: true
            lastBillingMonth:
              type: string
              pattern: '^\d{4}å¹´\d{1,2}æœˆ$'
              nullable: true
            paymentMethod:
              type: string
              maxLength: 50
              nullable: true

    CreatePlotContractInput:
      type: object
      description: ç‰©ç†åŒºç”»ã¸ã®æ–°è¦å¥‘ç´„è¿½åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆphysicalPlotä¸è¦ï¼‰
      required:
        - contractPlot
        - saleContract
        - customer
      properties:
        contractPlot:
          type: object
          required:
            - contractAreaSqm
          properties:
            contractAreaSqm:
              type: number
              format: float
              description: å¥‘ç´„é¢ç©ï¼ˆã¡ï¼‰
              minimum: 0.01
              example: 1.8
            saleStatus:
              type: string
              maxLength: 50
              nullable: true
            locationDescription:
              type: string
              maxLength: 200
              nullable: true
        saleContract:
          type: object
          required:
            - contractDate
            - price
          properties:
            contractDate:
              type: string
              format: date
              example: "2024-06-01"
            price:
              type: number
              minimum: 0
              example: 500000
            paymentStatus:
              type: string
              maxLength: 50
              nullable: true
            reservationDate:
              type: string
              format: date
              nullable: true
            acceptanceNumber:
              type: string
              maxLength: 50
              nullable: true
            permitDate:
              type: string
              format: date
              description: è¨±å¯æ—¥
              nullable: true
            permitNumber:
              type: string
              maxLength: 50
              description: è¨±å¯ç•ªå·
              nullable: true
              example: "KYO-2024-0001"
            startDate:
              type: string
              format: date
              nullable: true
            notes:
              type: string
              maxLength: 1000
              nullable: true
        customer:
          type: object
          required:
            - name
            - nameKana
            - postalCode
            - address
          properties:
            name:
              type: string
              minLength: 1
              maxLength: 100
              example: ç”°ä¸­èŠ±å­
            nameKana:
              type: string
              pattern: '^[ã‚¡-ãƒ¶ãƒ¼\s]+$'
              maxLength: 100
              example: ã‚¿ãƒŠã‚«ãƒãƒŠã‚³
            birthDate:
              type: string
              format: date
              nullable: true
            gender:
              type: string
              enum: [male, female, other]
              nullable: true
            postalCode:
              type: string
              minLength: 1
              maxLength: 10
              example: "150-0002"
            address:
              type: string
              minLength: 1
              maxLength: 200
              example: æ±äº¬éƒ½æ¸‹è°·åŒº
            registeredAddress:
              type: string
              maxLength: 200
              nullable: true
            phoneNumber:
              type: string
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
            faxNumber:
              type: string
              pattern: '^0\d{1,4}-?\d{1,4}-?\d{4}$'
              nullable: true
            email:
              type: string
              format: email
              nullable: true
            notes:
              type: string
              maxLength: 1000
              nullable: true
        workInfo:
          type: object
          nullable: true
        billingInfo:
          type: object
          nullable: true
        usageFee:
          type: object
          nullable: true
        managementFee:
          type: object
          nullable: true
    Pagination:
      type: object
      properties:
        total:
          type: integer
          example: 100
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        totalPages:
          type: integer
          example: 5

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ
            details:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                    example: plot.plotNumber
                  message:
                    type: string
                    example: åŒºç”»ç•ªå·ã¯å¿…é ˆã§ã™

  responses:
    BadRequest:
      description: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: VALIDATION_ERROR
              message: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ
              details:
                - field: plot.plotNumber
                  message: åŒºç”»ç•ªå·ã¯å¿…é ˆã§ã™

    Unauthorized:
      description: èªè¨¼ã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: UNAUTHORIZED
              message: èªè¨¼ãŒå¿…è¦ã§ã™
              details: []

    Forbidden:
      description: æ¨©é™ã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: FORBIDDEN
              message: ã“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“
              details: []

    NotFound:
      description: ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: NOT_FOUND
              message: æŒ‡å®šã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
              details: []

    Conflict:
      description: ãƒ‡ãƒ¼ã‚¿ç«¶åˆã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: CONFLICT
              message: åŒºç”»ç•ªå·ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™
              details: []

    ServiceUnavailable:
      description: ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ä¸å¯
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            error:
              code: SERVICE_UNAVAILABLE
              message: Supabaseèªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“
              details: []
